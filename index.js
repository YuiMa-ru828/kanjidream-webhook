// 必要なライブラリを読み込み
const express = require('express');
const bodyParser = require('body-parser');
const axios = require('axios');

const app = express();
app.use(bodyParser.json());

// LINEチャンネルアクセストークン
const CHANNEL_ACCESS_TOKEN = 'YOUR_CHANNEL_ACCESS_TOKEN';

// 言葉リスト
const words = {
    "รัก": ["愛", "心", "絆"],
    "ความสุข": ["幸", "福", "和"],
    "โชคดี": ["幸", "運", "瑞"],
    "ความฝัน": ["夢", "星", "光"],
    "ครอบครัว": ["家", "絆", "和"],
    "มิตรภาพ": ["友", "絆", "和"],
    "ความสำเร็จ": ["成", "勝", "達"],
    "ชีวิต": ["生", "命", "道"],
    "ความหวัง": ["希", "望", "光"],
    "ศรัทธา": ["信", "願", "心"],
    "ความสงบ": ["和", "安", "静"],
    "อิสระ": ["自", "風", "翼"],
    "พลัง": ["力", "魂", "志"],
    "แรงบันดาลใจ": ["想", "創", "夢"],
    "สุขภาพ": ["健", "心", "体"],
    "รอยยิ้ม": ["笑", "楽", "陽"],
    "การเดินทาง": ["旅", "道", "空"],
    "ธรรมชาติ": ["自", "森", "花"],
    "ความเข้มแข็ง": ["強", "剛", "力"],
    "ความอดทน": ["忍", "耐", "強"],
    "แสงสว่าง": ["光", "明", "輝"],
    "ดวงดาว": ["星", "輝", "夜"],
    "ความจริง": ["真", "誠", "実"],
    "ความยุติธรรม": ["正", "義", "直"],
    "ศิลปะ": ["芸", "美", "雅"],
    "ความมุ่งมั่น": ["志", "意", "望"],
    "ความคิดสร้างสรรค์": ["創", "想", "新"],
    "ความมั่งคั่ง": ["富", "金", "栄"],
    "ความอบอุ่น": ["温", "和", "陽"],
    "ความฝันอันยิ่งใหญ่": ["夢", "大", "翔"],
    "ความสุขเล็กๆ": ["小", "福", "喜"],
    "การเรียนรู้": ["学", "知", "道"],
    "ความกล้าหาญ": ["勇", "志", "進"],
    "ความทรงจำ": ["思", "記", "想"],
    "ความรักที่บริสุทธิ์": ["純", "愛", "心"],
    "การเริ่มต้นใหม่": ["新", "始", "開"],
    "กาลเวลา": ["時", "流", "瞬"],
    "ความมั่นใจ": ["自", "信", "強"],
    "ความเสียสละ": ["献", "愛", "心"],
    "ความจริงใจ": ["誠", "真", "信"],
    "ความสุขสงบ": ["静", "安", "和"],
    "ความคิดเชิงบวก": ["楽", "陽", "望"],
    "การดูแล": ["護", "守", "愛"],
    "ความนอบน้อม": ["謙", "恭", "敬"],
    "สันติภาพ": ["和", "平", "安"],
    "ดวงตะวัน": ["陽", "日", "空"],
    "ความอดทนอดกลั้น": ["忍", "耐", "我"],
    "ความรักในครอบครัว": ["家", "絆", "愛"],
    "ความฝันในวัยเด็ก": ["夢", "童", "光"]
  };

// 名前リスト (タイ語と英語両対応)
const names = {
    "Som": ["健", "恵", "清"], "สม": ["健", "恵", "清"],
    "Chai": ["勇", "勝", "健"], "ชาย": ["勇", "勝", "健"],
    "Pim": ["美", "雅", "純"], "พิมพ์": ["美", "雅", "純"],
    "Aom": ["心", "優", "和"], "อ้อม": ["心", "優", "和"],
    "Fon": ["雨", "瑞", "清"], "ฝน": ["雨", "瑞", "清"],
    "Nam": ["水", "流", "泉"], "น้ำ": ["水", "流", "泉"],
    "May": ["明", "光", "愛"], "เมย์": ["明", "光", "愛"],
    "Ning": ["寧", "和", "静"], "หนิง": ["寧", "和", "静"],
    "Beer": ["快", "陽", "楽"], "เบียร์": ["快", "陽", "楽"],
    "Gift": ["贈", "華", "幸"], "กิ๊ฟ": ["贈", "華", "幸"],
    "View": ["景", "望", "光"], "วิว": ["景", "望", "光"],
    "Mind": ["心", "志", "想"], "มายด์": ["心", "志", "想"],
    "Ice": ["氷", "清", "晶"], "ไอซ์": ["氷", "清", "晶"],
    "Bow": ["結", "華", "愛"], "โบว์": ["結", "華", "愛"],
    "Earth": ["地", "空", "穏"], "เอิร์ธ": ["地", "空", "穏"],
    "Oil": ["柔", "温", "滑"], "ออย": ["柔", "温", "滑"],
    "Pat": ["優", "純", "麗"], "แพท": ["優", "純", "麗"],
    "Fah": ["空", "青", "光"], "ฟ้า": ["空", "青", "光"],
    "Yim": ["笑", "陽", "楽"], "ยิ้ม": ["笑", "陽", "楽"],
    "Pan": ["美", "雅", "花"], "แป้น": ["美", "雅", "花"],
    "Gun": ["守", "勇", "心"], "กัน": ["守", "勇", "心"],
    "Bam": ["福", "陽", "愛"], "แบม": ["福", "陽", "愛"],
    "Jay": ["誠", "清", "心"], "เจ": ["誠", "清", "心"],
    "Ten": ["天", "星", "翔"], "เตนล์": ["天", "星", "翔"],
    "Tle": ["明", "楽", "進"], "เติ้ล": ["明", "楽", "進"],
    "Benz": ["迅", "陽", "力"], "เบนซ์": ["迅", "陽", "力"],
    "Nat": ["成", "光", "楽"], "แนท": ["成", "光", "楽"],
    "Film": ["映", "夢", "想"], "ฟิล์ม": ["映", "夢", "想"],
    "Name": ["名", "志", "記"], "เนม": ["名", "志", "記"],
    "Namtan": ["甘", "喜", "美"], "น้ำตาล": ["甘", "喜", "美"],
    "Tao": ["龍", "寿", "悠"], "เต่า": ["龍", "寿", "悠"],
    "Oat": ["豊", "実", "福"], "โอ๊ต": ["豊", "実", "福"],
    "Bas": ["飛", "翔", "夢"], "บาส": ["飛", "翔", "夢"],
    "Ploy": ["宝", "彩", "華"], "พลอย": ["宝", "彩", "華"],
    "Jame": ["珠", "誠", "雅"], "เจมส์": ["珠", "誠", "雅"],
    "Sun": ["陽", "光", "暖"], "ซัน": ["陽", "光", "暖"],
    "Korn": ["力", "創", "成"], "กร": ["力", "創", "成"],
    "Mew": ["音", "夢", "光"], "มิว": ["音", "夢", "光"],
    "Arm": ["守", "健", "進"], "อาร์ม": ["守", "健", "進"],
    "Tum": ["大", "翔", "夢"], "ตั้ม": ["大", "翔", "夢"],
    "Toon": ["音", "動", "楽"], "ตูน": ["音", "動", "楽"],
    "Praew": ["彩", "華", "麗"], "แพรว": ["彩", "華", "麗"],
    "Pak": ["福", "清", "恵"], "ภัค": ["福", "清", "恵"],
    "Petch": ["宝", "輝", "星"], "เพชร": ["宝", "輝", "星"],
    "Boss": ["首", "勝", "導"], "บอส": ["首", "勝", "導"],
    "Sky": ["空", "翔", "青"], "สกาย": ["空", "翔", "青"],
    "Dream": ["夢", "想", "光"], "ดรีม": ["夢", "想", "光"]
};

// 以下、メッセージ受信処理はそのまま
// メッセージ受信時の処理
app.post('/webhook', async (req, res) => {
  const events = req.body.events;

  for (const event of events) {
    if (event.type === 'message' && event.message.type === 'text') {
      const userMessage = event.message.text.trim();
      let replyText = '';

      if (words[userMessage]) {
        // 普通の言葉リストにマッチ
        const kanjiList = words[userMessage];
        replyText = `✨ นี่คือชื่อคันจิที่ฉันเลือกมาให้คุณค่ะ ✨\n${kanjiList.join('\n')}\n\nหากต้องการชื่อคันจิพิเศษแบบเฉพาะตัว สามารถสอบถามเพิ่มเติมได้เลยค่ะ ✨`;
      } else {
        // 名前リストの簡易マッチ（大文字小文字無視）
        const found = Object.keys(names).find(name => name.toLowerCase() === userMessage.toLowerCase());

        if (found) {
          const kanjiList = names[found];
          replyText = `✨ นี่คือชื่อคันจิที่ฉันเลือกมาให้คุณค่ะ ✨\n${kanjiList.join('\n')}\n\nหากต้องการชื่อคันจิพิเศษแบบเฉพาะตัว สามารถสอบถามเพิ่มเติมได้เลยค่ะ ✨`;
        } else {
          // どちらにもマッチしない場合
          replyText = `ขอโทษค่ะ ✨ ฉันยังไม่สามารถเลือกชื่อให้ได้ กรุณาลองส่งคำใหม่อีกครั้งนะคะ ✨`;
        }
      }

      // LINEに返信
      await axios.post('https://api.line.me/v2/bot/message/reply', {
        replyToken: event.replyToken,
        messages: [{ type: 'text', text: replyText }]
      }, {
        headers: {
          'Content-Type': 'application/json',
          'Authorization': `Bearer ${CHANNEL_ACCESS_TOKEN}`
        }
      });
    }
  }

  res.sendStatus(200);
});
