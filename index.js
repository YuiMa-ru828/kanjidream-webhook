// 必要なライブラリを読み込み
const express = require('express');
const bodyParser = require('body-parser');
const axios = require('axios');

const app = express();
app.use(bodyParser.json());

// LINEチャンネルアクセストークン
const CHANNEL_ACCESS_TOKEN = 'KfEV7yDiLuaMU9iaiD4XpiAyWWFXBGvxAkqwZ2E5jBfhQOTCGwckXmx6Hoo2XtnBCv+TbwCWYuHnrqmeLZIo6p3K4gXmSSOF0/SGFoBdGieizCIj/L7VtCz2DhLagaOjosXMwiIRvMyVhbmdf45vRAdB04t89/1O/w1cDnyilFU=';

// 言葉リスト（タイ語50個）
const words = {
  "รัก": ["愛", "心", "絆"],
  "ความสุข": ["幸", "福", "和"],
  "โชคดี": ["幸", "運", "瑞"],
  "ความฝัน": ["夢", "星", "光"],
  "ครอบครัว": ["家", "絆", "和"],
  "มิตรภาพ": ["友", "絆", "和"],
  "ความสำเร็จ": ["成", "勝", "達"],
  "ชีวิต": ["生", "命", "道"],
  "ความหวัง": ["希", "望", "光"],
  "ศรัทธา": ["信", "願", "心"],
  "ความสงบ": ["和", "安", "静"],
  "อิสระ": ["自", "風", "翼"],
  "พลัง": ["力", "魂", "志"],
  "แรงบันดาลใจ": ["想", "創", "夢"],
  "สุขภาพ": ["健", "心", "体"],
  "รอยยิ้ม": ["笑", "楽", "陽"],
  "การเดินทาง": ["旅", "道", "空"],
  "ธรรมชาติ": ["自", "森", "花"],
  "ความเข้มแข็ง": ["強", "剛", "力"],
  "ความอดทน": ["忍", "耐", "強"],
  "แสงสว่าง": ["光", "明", "輝"],
  "ดวงดาว": ["星", "輝", "夜"],
  "ความจริง": ["真", "誠", "実"],
  "ความยุติธรรม": ["正", "義", "直"],
  "ศิลปะ": ["芸", "美", "雅"],
  "ความมุ่งมั่น": ["志", "意", "望"],
  "ความคิดสร้างสรรค์": ["創", "想", "新"],
  "ความมั่งคั่ง": ["富", "金", "栄"],
  "ความอบอุ่น": ["温", "和", "陽"],
  "ความฝันอันยิ่งใหญ่": ["夢", "大", "翔"],
  "ความสุขเล็กๆ": ["小", "福", "喜"],
  "การเรียนรู้": ["学", "知", "道"],
  "ความกล้าหาญ": ["勇", "志", "進"],
  "ความทรงจำ": ["思", "記", "想"],
  "ความรักที่บริสุทธิ์": ["純", "愛", "心"],
  "การเริ่มต้นใหม่": ["新", "始", "開"],
  "กาลเวลา": ["時", "流", "瞬"],
  "ความมั่นใจ": ["自", "信", "強"],
  "ความเสียสละ": ["献", "愛", "心"],
  "ความจริงใจ": ["誠", "真", "信"],
  "ความสุขสงบ": ["静", "安", "和"],
  "ความคิดเชิงบวก": ["楽", "陽", "望"],
  "การดูแล": ["護", "守", "愛"],
  "ความนอบน้อม": ["謙", "恭", "敬"],
  "สันติภาพ": ["和", "平", "安"],
  "ดวงตะวัน": ["陽", "日", "空"],
  "ความอดทนอดกลั้น": ["忍", "耐", "我"],
  "ความรักในครอบครัว": ["家", "絆", "愛"],
  "ความฝันในวัยเด็ก": ["夢", "童", "光"]
};

// 名前リスト（英語・タイ語50個）
const names = {
  "som": ["健", "恵", "清"], "สม": ["健", "恵", "清"],
  "chai": ["勇", "勝", "健"], "ชาย": ["勇", "勝", "健"],
  "pim": ["美", "雅", "純"], "พิมพ์": ["美", "雅", "純"],
  "aom": ["心", "優", "和"], "อ้อม": ["心", "優", "和"],
  "fon": ["雨", "瑞", "清"], "ฝน": ["雨", "瑞", "清"],
  "nam": ["水", "流", "泉"], "น้ำ": ["水", "流", "泉"],
  "may": ["明", "光", "愛"], "เมย์": ["明", "光", "愛"],
  "ning": ["寧", "和", "静"], "หนิง": ["寧", "和", "静"],
  "beer": ["快", "陽", "楽"], "เบียร์": ["快", "陽", "楽"],
  "gift": ["贈", "華", "幸"], "กิ๊ฟ": ["贈", "華", "幸"],
  "view": ["景", "望", "光"], "วิว": ["景", "望", "光"],
  "mind": ["心", "志", "想"], "มายด์": ["心", "志", "想"],
  "ice": ["氷", "清", "晶"], "ไอซ์": ["氷", "清", "晶"],
  "bow": ["結", "華", "愛"], "โบว์": ["結", "華", "愛"],
  "earth": ["地", "空", "穏"], "เอิร์ธ": ["地", "空", "穏"],
  "oil": ["柔", "温", "滑"], "ออย": ["柔", "温", "滑"],
  "pat": ["優", "純", "麗"], "แพท": ["優", "純", "麗"],
  "fah": ["空", "青", "光"], "ฟ้า": ["空", "青", "光"],
  "yim": ["笑", "陽", "楽"], "ยิ้ม": ["笑", "陽", "楽"],
  "pan": ["美", "雅", "花"], "แป้น": ["美", "雅", "花"],
  "gun": ["守", "勇", "心"], "กัน": ["守", "勇", "心"],
  "bam": ["福", "陽", "愛"], "แบม": ["福", "陽", "愛"],
  "jay": ["誠", "清", "心"], "เจ": ["誠", "清", "心"],
  "ten": ["天", "星", "翔"], "เตนล์": ["天", "星", "翔"]
};

// メッセージ受信時の処理
app.post('/webhook', async (req, res) => {
  const events = req.body.events;

  for (const event of events) {
    if (event.type === 'message' && event.message.type === 'text') {
      const userMessage = event.message.text.trim().toLowerCase();
      let replyText = '';

      if (words[userMessage]) {
        const kanjiList = words[userMessage];
        replyText = `✨ นี่คือคันจิที่เหมาะกับคำของคุณค่ะ ✨\n${kanjiList.join('\n')}\n\nอยากได้ความหมายเพิ่มเติมไหมคะ? ✨`;
      } else if (names[userMessage]) {
        const kanjiList = names[userMessage];
        replyText = `✨ นี่คือชื่อคันจิที่ฉันเลือกมาให้คุณค่ะ ✨\n${kanjiList.join('\n')}\n\nหากต้องการชื่อคันจิพิเศษแบบเฉพาะตัว สามารถสอบถามเพิ่มเติมได้เลยค่ะ ✨`;
      } else {
        replyText = `ขอโทษค่ะ ✨ ฉันยังไม่สามารถเลือกชื่อให้ได้ กรุณาลองส่งคำใหม่อีกครั้งนะคะ ✨`;
      }

      await axios.post('https://api.line.me/v2/bot/message/reply', {
        replyToken: event.replyToken,
        messages: [{ type: 'text', text: replyText }]
      }, {
        headers: {
          'Content-Type': 'application/json',
          'Authorization': `Bearer ${CHANNEL_ACCESS_TOKEN}`
        }
      });
    }
  }

  res.sendStatus(200);
});